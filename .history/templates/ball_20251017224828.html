<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meet</title>
    <link rel="stylesheet" href="/static/style.css"/>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

</head>
<body>
    <div class="gradient-bg"></div>
        <div class="stars" id="stars"></div>
 
  <img src="static/assets/bg-img.jpeg" id= "bg-img">
  <!-- towers -->
  <img src="static/assets/opp-archer.png" id="opp-archer">
  <img src="static/assets/opp-king.png" id="opp-king">
  <img src="static/assets/our-archer.png" id="our-archer">
  <img src="static/assets/our-king.png" id="our-king">

  <!-- <img src="assets/elixir-bar.png" id = 'opp-bar'> -->
<div id="game-wrapper" style="position:relative; width:480px; height:720px;">
  <!-- Canvas -->
  <canvas id="canvas" width="480" height="720"
          ></canvas>

  <!-- Background/towers (hidden, used for ctx.drawImage) -->
  <img src="static/assets/bg-img.jpeg" id="bg-img" style="display:none;">
  <img src="static/assets/opp-archer.png" id="opp-archer0" style="display:none;">
  <img src="static/assets/opp-archer.png" id="opp-archer1" style="display:none;">

  <img src="static/assets/opp-king.png" id="opp-king" style="display:none;">
  <img src="static/assets/our-archer.png" id="our-archer0" style="display:none;">
  <img src="static/assets/our-archer.png" id="our-archer1" style="display:none;">

  <img src="static/assets/our-king.png" id="our-king" style="display:none;">

  <!-- Our deck -->
  <img src="static/assets/knight-p.png" id="our-knight" draggable="true"
       ondragstart="onDragStart(event, 'knight','our')">
  <img src="static/assets/valk-p.png" id="our-valk" draggable="true"
       ondragstart="onDragStart(event, 'valkyrie','our')">
  <img src="static/assets/pekka-p.png" id="our-pekka" draggable="true"
       ondragstart="onDragStart(event, 'pekka','our')">
  <img src="static/assets/giant-p.png" id="our-royal_giant" draggable="true"
       ondragstart="onDragStart(event, 'royal_giant','our')">

  <!-- Our bar -->
  <img src="static/assets/elixir-bar.png" id="our-bar">

  <!-- Opp deck -->
  <img src="static/assets/knight-p.png" id="opp-knight" draggable="true"
       ondragstart="onDragStart(event, 'knight','opp')">
  <img src="static/assets/valk-p.png" id="opp-valk" draggable="true"
       ondragstart="onDragStart(event, 'valkyrie','opp')">
  <img src="static/assets/pekka-p.png" id="opp-pekka" draggable="true"
       ondragstart="onDragStart(event, 'pekka','opp')">
  <img src="static/assets/giant-p.png" id="opp-royal_giant" draggable="true"
       ondragstart="onDragStart(event, 'royal_giant','opp')">

  <!-- Opp bar -->
  <img src="static/assets/elixir-bar.png" id="opp-bar">

  <!-- crown -->
  <img src="static/assets/crown-blue.png" id="crownblue" style="display:none;">
  <img src="static/assets/crown-red.png" id="crownred" style="display:none;">

  <!-- crown cusshion -->
  <img src="static/assets/red-cushion.png" id="cushionred" style="display:none;">
  <img src="static/assets/blue-cushion.png" id="cushionblue" style="display:none;">

</div>
   <script>
  // expose globals so game-logic.js can use them
  window.ai_mode = {{ ai_mode | tojson }};
  window.multi = {{ multi | tojson }};
  window.roomId = "{{ room|default('') }}"; // if /multi passed ?room= then flask provided room
  // fallback: read localStorage if server didn't pass room
  if (!window.roomId) {
    window.roomId = localStorage.getItem('room') || "";
  }

  // create a truly-global socket reference
  window.socket = io();

  // join the room on the socket side (use server handler 'join' or 'join_room' depending on server)
  if (window.multi && window.roomId) {
    // Using the existing 'join' server event expects room, name, user_id,
    // but we can send a minimal join event for socket room membership.
    window.socket.emit('join_room', { room: window.roomId });
  }

  // server -> spawn handler will call makeActive (game-logic.js must be loaded next)
  window.socket.on("spawn_character", (data) => {
    // compute mirrored side & normalized handling (game-logic will be able to use canvas.width)
    const mirroredOpp = data.opp_or_not === 'our' ? 'opp' : 'our';

    // if you send normalized coords (recommended), data.xPct / data.yPct will exist
    if (typeof data.xPct === 'number' && typeof data.yPct === 'number') {
      // game-logic.js has a global canvas & playersize
      const x = Math.round(canvas.width * data.xPct);
      const y = Math.round(canvas.height * data.yPct);

      // mirror horizontally (use playersize/centering)
      const mirroredX = canvas.width - x - (playersize / 2); // adjust depending on how you center
      makeActive(data.type, mirroredX, y, mirroredOpp, true);
    } else {
      // fallback to raw pixels (less robust)
      const mirroredX = (canvas.width || 1280) - data.x - (playersize / 2);
      makeActive(data.type, mirroredX, data.y, mirroredOpp, true);
    }
  });
</script>
     </script>
     <script src="/static/game-logic.js"></script>
     
    <script>
        // Create twinkling stars
        
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 150; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.animation = `twinkle ${2 + Math.random() * 3}s infinite ${Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
        
</script>
</body>
</html>


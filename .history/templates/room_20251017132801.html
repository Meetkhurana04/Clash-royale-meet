<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Room {{ room }}</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { background:#0b0b0b; color:#fff; font-family:Segoe UI, Roboto, Arial; padding:24px; }
    .card { max-width:560px; margin:32px auto; padding:18px; border-radius:12px; background:#111; border:1px solid rgba(255,255,255,0.04); }
    .room-code { font-weight:800; color:#ffd700; font-size:28px; }
    .members { margin-top:12px; }
    .member { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }
    .btn { padding:10px 12px; border-radius:10px; cursor:pointer; border:none; font-weight:700; }
    .btn.leave { background:linear-gradient(135deg,#ff6b6b,#ff3b3b); color:#fff; }
    .btn.copy { background:linear-gradient(135deg,#ffd700,#ffb300); color:#5a3a00; border:2px solid #ff9800; }
  </style>
</head>
<body>
  <div class="card">
    <div style="text-align:center;">
      <div style="font-size:13px;color:#aaa">Room code</div>
      <div class="room-code">{{ room }}</div>
      <div style="margin-top:8px;color:#ccc">You: <strong id="youName">{{ name }}</strong></div>
    </div>

    <div style="display:flex;gap:8px; justify-content:center; margin-top:12px;">
      <button id="copyBtn" class="btn copy">Copy code</button>
      <button id="leaveBtn" class="btn leave">Leave room</button>
    </div>

    <hr style="border:none; border-top:1px solid rgba(255,255,255,0.04); margin:14px 0;">
    <div>
      <div style="color:#bbb; font-weight:700; margin-bottom:8px;">Players in room</div>
      <div id="membersList" class="members">
        <!-- dynamic -->
      </div>
    </div>
  </div>

<script>
  const room = "{{ room }}";
  const name = "{{ name }}";
  const socket = io({ autoConnect: true });

  socket.on("connect", () => {
    // tell server we've joined this room (server side will track using sid -> name mapping)
    socket.emit("join", { room, name });
  });

  socket.on("room_update", (data) => {
    if (!data || data.room !== room) return;
    const members = data.members || [];
    const container = document.getElementById('membersList');
    container.innerHTML = '';
    members.forEach(m => {
      const div = document.createElement('div');
      div.className = 'member';
      div.textContent = m;
      container.appendChild(div);
    });
  });

  document.getElementById('leaveBtn').addEventListener('click', () => {
    socket.emit('leave', { room });
    // clear session on server? we just redirect to home so session stays but user left socket room
    window.location.href = "/";
  });

  document.getElementById('copyBtn').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(room);
      alert('Copied room code: ' + room);
    } catch (e) {
      alert('Copy failed. Code: ' + room);
    }
  });

  window.addEventListener('beforeunload', () => {
    socket.emit('leave', { room });
  });
</script>
</body>
</html>
